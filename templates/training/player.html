{% extends "base.html" %}

{% block title %}{{ training.title }} - {{ app_name }}{% endblock %}

{% block content %}
<div class="training-player" id="trainingPlayer" data-training-id="{{ training.id }}" data-slide-count="{{ training.slide_count }}">
    <!-- Progress Bar at Top -->
    <div class="player-progress-bar">
        <div class="progress" style="height: 5px; border-radius: 0;">
            <div class="progress-bar bg-success" 
                 role="progressbar" 
                 id="topProgressBar"
                 style="width: {{ progress.completion_percentage }}%"
                 aria-valuenow="{{ progress.completion_percentage }}" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
            </div>
        </div>
    </div>

    <!-- Header Bar -->
    <div class="player-header bg-dark text-white">
        <div class="container-fluid">
            <div class="row align-items-center py-2">
                <div class="col-md-4">
                    <h5 class="mb-0">{{ training.title }}</h5>
                </div>
                <div class="col-md-4 text-center">
                    <span id="slideCounter">Diapositive <span id="currentSlide">{{ progress.current_slide_index + 1 }}</span> sur <span id="totalSlides">{{ training.slide_count }}</span></span>
                </div>
                <div class="col-md-4 text-end">
                    <button type="button" class="btn btn-outline-light btn-sm" id="exitButton">
                        <i class="bi bi-box-arrow-left"></i> Quitter
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Slide Content Area -->
    <div class="player-content" id="slideContent">
        <div class="container py-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div id="slideDisplay" class="slide-content">
                        <!-- Slide content will be loaded here dynamically -->
                        <div class="text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Chargement...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Controls -->
    <div class="player-controls bg-light border-top">
        <div class="container-fluid">
            <div class="row align-items-center py-3">
                <div class="col-md-4">
                    <button type="button" class="btn btn-secondary" id="prevButton" disabled>
                        <i class="bi bi-arrow-left"></i> Précédent
                    </button>
                </div>
                <div class="col-md-4 text-center">
                    <small class="text-muted" id="progressText">
                        {{ progress.completed_slides|length }} / {{ training.slide_count }} diapositives complétées
                    </small>
                </div>
                <div class="col-md-4 text-end">
                    <button type="button" class="btn btn-primary" id="nextButton">
                        Suivant <i class="bi bi-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Exit Confirmation Modal -->
<div class="modal fade" id="exitModal" tabindex="-1" aria-labelledby="exitModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exitModalLabel">Quitter la formation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Êtes-vous sûr de vouloir quitter cette formation?</p>
                <p class="text-muted mb-0">Votre progression sera sauvegardée automatiquement.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <a href="{{ url_for('training.list_trainings') }}" class="btn btn-primary">Quitter</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
<style>
    body {
        overflow-x: hidden;
    }
    
    .training-player {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 1050;
        background: white;
    }
    
    .player-progress-bar {
        flex-shrink: 0;
    }
    
    .player-header {
        flex-shrink: 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .player-content {
        flex: 1;
        overflow-y: auto;
        background: #f8f9fa;
    }
    
    .player-controls {
        flex-shrink: 0;
        box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
    }
    
    .slide-content {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        min-height: 300px;
    }
    
    /* Hide main navbar and footer in player */
    .navbar, .footer, main.container {
        display: none !important;
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/training.js') }}"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize training player
        const player = new TrainingPlayer({
            trainingId: {{ training.id }},
            currentSlideIndex: {{ progress.current_slide_index }},
            totalSlides: {{ training.slide_count }},
            completedSlides: {{ progress.completed_slides|tojson }}
        });
        
        // Exit button handler
        document.getElementById('exitButton').addEventListener('click', function() {
            const exitModal = new bootstrap.Modal(document.getElementById('exitModal'));
            exitModal.show();
        });
    });
</script>
{% endblock %}
